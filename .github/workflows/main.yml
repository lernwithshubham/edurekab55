name: Simple Workflow # Name of the workflow

on:
  push:
    branches:
      - main # Trigger the workflow on push events to the 'main' branch

env:
  NODE_ENV: production # Define a global environment variable
  APP_VERSION: 1.0.0 # Example of another environment variable

jobs:
  build: # Define a job named 'build'
    runs-on: ubuntu-latest # Specify the environment to run the job (Ubuntu)

    steps:
      - name: Checkout code # Step to check out the repository code
        uses: actions/checkout@v3

      - name: Set up Node.js # Set up Node.js environment
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Validate environment variables # Echo environment variables
        run: |
          echo "NODE_ENV is set to $NODE_ENV"
          echo "APP_VERSION is set to $APP_VERSION"

      - name: Install dependencies # Install project dependencies
        run: npm install

      - name: Run build script # Run the build script
        run: npm run build

      - name: Run tests # Run tests
        run: npm test

      - name: Post-build validation # Validate the build output
        run: |
          echo "Validating build output..."
          if [ ! -d "dist" ]; then
            echo "Build output directory 'dist' not found!"
            exit 1
          fi
          echo "Build output validated successfully."

      - name: Upload build artifact # Upload the build output as an artifact
        uses: actions/upload-artifact@v4
        with:
          name: build-artifact
          path: dist/ # Replace with the path to your build output
